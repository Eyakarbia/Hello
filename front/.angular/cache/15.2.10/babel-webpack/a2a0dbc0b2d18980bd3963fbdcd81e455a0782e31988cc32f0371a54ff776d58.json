{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./services/game-manager.service\";\nimport * as i2 from \"./board/board.component\";\nconst GAME_SPEED = 500;\nconst MOVE_DOWN_SPEED = 0.2; // fraction of initial game speed\nconst SPEED_INCREASE_FACTOR = 0.9; // Decrease interval by 10% each time\nexport var GameState;\n(function (GameState) {\n  GameState[GameState[\"Paused\"] = 0] = \"Paused\";\n  GameState[GameState[\"Started\"] = 1] = \"Started\";\n  GameState[GameState[\"Over\"] = 2] = \"Over\";\n})(GameState || (GameState = {}));\nexport class TetrisCoreComponent {\n  constructor(_manager) {\n    this._manager = _manager;\n    this.initialSpeed = GAME_SPEED;\n    this.rotate = false;\n    this.moveLeft = false;\n    this.moveRight = false;\n    this.moveDown = false;\n    this.drop = false;\n    this.start = false;\n    this.stop = false;\n    this.reset = false;\n    this.lineCleared = new EventEmitter();\n    this.gameOver = new EventEmitter();\n    this.state = GameState.Paused;\n    this.level = 1; // Initial level\n    this.gridWidth = 10;\n    this.gridHeight = 20;\n    this._moveDownSpeed = GAME_SPEED * MOVE_DOWN_SPEED;\n    this._manager.lineCleared$.subscribe(() => this._onLineCleared());\n    this._manager.gameOver$.subscribe(() => this._onGameOver());\n  }\n  _updateGameSpeed() {\n    this.initialSpeed = Math.max(minimumSpeedLimit, this.initialSpeed * SPEED_INCREASE_FACTOR);\n    this._moveDownSpeed = this.initialSpeed * MOVE_DOWN_SPEED;\n    this._setMoveDownInterval();\n  }\n  ngOnInit() {\n    this._moveDownSpeed = this.initialSpeed * MOVE_DOWN_SPEED;\n    this._manager.initialize(this.gridWidth, this.gridHeight, this.initialSpeed, this.tileSize);\n    this.grid = this._manager.grid;\n    this._setMoveDownInterval();\n  }\n  _setMoveDownInterval() {\n    if (this._intervalId) {\n      clearInterval(this._intervalId); // Clear existing interval\n    }\n\n    this._intervalId = setInterval(() => {\n      if (this.moveDown) {\n        this._manager.moveDown();\n      }\n    }, this._moveDownSpeed);\n  }\n  ngOnChanges(changes) {\n    if (this._keyPressed(changes['moveLeft'])) {\n      this._manager.moveLeft();\n    } else if (this._keyPressed(changes['moveRight'])) {\n      this._manager.moveRight();\n    } else if (this._keyPressed(changes['drop'])) {\n      this._manager.drop();\n    }\n    if (this._keyPressed(changes['rotate'])) {\n      this._manager.rotate();\n    }\n    if (this._keyPressed(changes['start'])) {\n      this._manager.start();\n    }\n    if (this._keyPressed(changes['stop'])) {\n      this._manager.stop();\n    }\n    if (this._keyPressed(changes['reset'])) {\n      this._manager.reset();\n    }\n  }\n  actionLeft() {\n    this._manager.moveLeft();\n  }\n  actionRight() {\n    this._manager.moveRight();\n  }\n  actionRotate() {\n    this._manager.rotate();\n  }\n  actionDown() {\n    this._manager.moveDown();\n  }\n  actionDrop() {\n    this._manager.drop();\n  }\n  actionReset() {\n    this._manager.reset();\n  }\n  actionStart() {\n    this._manager.start();\n    this.state = GameState.Started;\n  }\n  actionStop() {\n    if (this.state === GameState.Started) {\n      this._manager.stop(); // Stop the game\n      this.state = GameState.Paused; // Update state to Paused\n    } else if (this.state === GameState.Paused) {\n      this._manager.start(); // Resume the game\n      this.state = GameState.Started; // Update state to Started\n    }\n  }\n\n  _keyPressed(key) {\n    return key && key.currentValue && !key.previousValue;\n  }\n  _onLineCleared() {\n    this.lineCleared.emit();\n    this._updateGameSpeed(); // Update game speed when a line is cleared\n  }\n\n  _onGameOver() {\n    this.state = GameState.Over;\n    this.gameOver.emit();\n  }\n  static #_ = this.ɵfac = function TetrisCoreComponent_Factory(t) {\n    return new (t || TetrisCoreComponent)(i0.ɵɵdirectiveInject(i1.GameManagerService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: TetrisCoreComponent,\n    selectors: [[\"tetris-core\"]],\n    inputs: {\n      tileSize: \"tileSize\",\n      initialSpeed: \"initialSpeed\",\n      rotate: \"rotate\",\n      moveLeft: \"moveLeft\",\n      moveRight: \"moveRight\",\n      moveDown: \"moveDown\",\n      drop: \"drop\",\n      start: \"start\",\n      stop: \"stop\",\n      reset: \"reset\"\n    },\n    outputs: {\n      lineCleared: \"lineCleared\",\n      gameOver: \"gameOver\"\n    },\n    features: [i0.ɵɵNgOnChangesFeature],\n    decls: 1,\n    vars: 1,\n    consts: [[3, \"grid\"]],\n    template: function TetrisCoreComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelement(0, \"board\", 0);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"grid\", ctx.grid);\n      }\n    },\n    dependencies: [i2.BoardComponent],\n    encapsulation: 2\n  });\n}","map":{"version":3,"mappings":"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","names":["EventEmitter","GAME_SPEED","MOVE_DOWN_SPEED","SPEED_INCREASE_FACTOR","GameState","TetrisCoreComponent","constructor","_manager","Paused","lineCleared$","subscribe","_onLineCleared","gameOver$","_onGameOver","_updateGameSpeed","initialSpeed","Math","max","minimumSpeedLimit","_moveDownSpeed","_setMoveDownInterval","ngOnInit","initialize","gridWidth","gridHeight","tileSize","grid","_intervalId","clearInterval","setInterval","moveDown","ngOnChanges","changes","_keyPressed","moveLeft","moveRight","drop","rotate","start","stop","reset","actionLeft","actionRight","actionRotate","actionDown","actionDrop","actionReset","actionStart","state","Started","actionStop","key","currentValue","previousValue","lineCleared","emit","Over","gameOver","selectors","inputs","outputs","features","decls","vars","consts","template","i0"],"sourceRoot":"","sources":["C:\\Users\\Tasnim\\OneDrive\\Desktop\\Tetris\\Hello\\front\\ngx-tetris\\src\\lib\\tetris-core.component.ts","C:\\Users\\Tasnim\\OneDrive\\Desktop\\Tetris\\Hello\\front\\ngx-tetris\\src\\lib\\tetris-core.component.html"],"sourcesContent":["import {\r\n  ChangeDetectionStrategy,\r\n  Component,\r\n  EventEmitter,\r\n  Input,\r\n  OnChanges,\r\n  OnInit,\r\n  Output, SimpleChange,\r\n  SimpleChanges\r\n} from '@angular/core';\r\nimport {GameManagerService, Tile} from './services/game-manager.service';\r\n\r\nconst GAME_SPEED = 500;\r\nconst MOVE_DOWN_SPEED = 0.2; // fraction of initial game speed\r\nconst SPEED_INCREASE_FACTOR = 0.9; // Decrease interval by 10% each time\r\n\r\nexport enum GameState {\r\n    Paused = 0,\r\n    Started = 1,\r\n    Over = 2\r\n}\r\n\r\n@Component({\r\n    selector: 'tetris-core',\r\n    templateUrl: './tetris-core.component.html',\r\n    // styleUrls: ['./tetris-core.component.css']\r\n})\r\nexport class TetrisCoreComponent implements OnInit, OnChanges {\r\n    @Input() tileSize: any;\r\n\r\n    @Input() initialSpeed: number = GAME_SPEED;\r\n    @Input() rotate = false;\r\n    @Input() moveLeft = false;\r\n    @Input() moveRight = false;\r\n    @Input() moveDown = false;\r\n    @Input() drop = false;\r\n    @Input() start = false;\r\n    @Input() stop = false;\r\n    @Input() reset = false;\r\n\r\n    @Output() lineCleared: EventEmitter<any> = new EventEmitter();\r\n    @Output() gameOver: EventEmitter<any> = new EventEmitter();\r\n\r\n    public grid!: Array<Tile>;\r\n    public state: GameState = GameState.Paused;\r\n    public level: number = 1; // Initial level\r\n\r\n\r\n    gridWidth = 10;\r\n    gridHeight = 20;\r\n\r\n    private _moveDownSpeed = GAME_SPEED * MOVE_DOWN_SPEED;\r\n    private _intervalId: any; // To keep track of the interval\r\n    private _updateGameSpeed() {\r\n        this.initialSpeed = Math.max(minimumSpeedLimit, this.initialSpeed * SPEED_INCREASE_FACTOR);\r\n        this._moveDownSpeed = this.initialSpeed * MOVE_DOWN_SPEED;\r\n        this._setMoveDownInterval();\r\n    }\r\n    \r\n    \r\n    constructor(private _manager: GameManagerService) {\r\n        this._manager.lineCleared$.subscribe(() => this._onLineCleared());\r\n        this._manager.gameOver$.subscribe(() => this._onGameOver());\r\n    }\r\n\r\n    ngOnInit() {\r\n    this._moveDownSpeed = this.initialSpeed * MOVE_DOWN_SPEED;\r\n    this._manager.initialize(this.gridWidth, this.gridHeight, this.initialSpeed, this.tileSize);\r\n    this.grid = this._manager.grid;\r\n\r\n    this._setMoveDownInterval();\r\n}\r\n\r\n   private _setMoveDownInterval() {\r\n    if (this._intervalId) {\r\n        clearInterval(this._intervalId); // Clear existing interval\r\n    }\r\n\r\n    this._intervalId = setInterval(() => {\r\n        if (this.moveDown) {\r\n            this._manager.moveDown();\r\n        }\r\n    }, this._moveDownSpeed);\r\n}\r\n\r\n    ngOnChanges(changes: SimpleChanges) {\r\n        if (this._keyPressed(changes['moveLeft'])) {\r\n            this._manager.moveLeft();\r\n        } else if (this._keyPressed(changes['moveRight'])) {\r\n            this._manager.moveRight();\r\n        } else if (this._keyPressed(changes['drop'])) {\r\n            this._manager.drop();\r\n        }\r\n\r\n        if (this._keyPressed(changes['rotate'])) { this._manager.rotate(); }\r\n        if (this._keyPressed(changes['start']))  { this._manager.start(); }\r\n        if (this._keyPressed(changes['stop']))  { this._manager.stop(); }\r\n        if (this._keyPressed(changes['reset']))  { this._manager.reset(); }\r\n   \r\n    }\r\n    \r\n\r\n    public actionLeft() { this._manager.moveLeft(); }\r\n    public actionRight() { this._manager.moveRight(); }\r\n    public actionRotate() { this._manager.rotate(); }\r\n    public actionDown() { this._manager.moveDown(); }\r\n    public actionDrop() { this._manager.drop(); }\r\n    public actionReset() { this._manager.reset(); }\r\n\r\n    public actionStart() {\r\n        this._manager.start();\r\n        this.state = GameState.Started;\r\n    }\r\n    public actionStop() {\r\n        if (this.state === GameState.Started) {\r\n            this._manager.stop(); // Stop the game\r\n            this.state = GameState.Paused; // Update state to Paused\r\n        } else if (this.state === GameState.Paused) {\r\n            this._manager.start(); // Resume the game\r\n            this.state = GameState.Started; // Update state to Started\r\n        }\r\n    }\r\n    \r\n\r\n    private _keyPressed(key: SimpleChange) {\r\n        return key && key.currentValue && !key.previousValue;\r\n    }\r\n\r\n    private _onLineCleared() {\r\n        this.lineCleared.emit();\r\n        this._updateGameSpeed(); // Update game speed when a line is cleared\r\n    }\r\n    \r\n\r\n    private _onGameOver() {\r\n        this.state = GameState.Over;\r\n        this.gameOver.emit();\r\n    }\r\n   \r\n   \r\n}\r\n","<board\r\n    [grid]=\"grid\"></board>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}